<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />

  <title>Module: English::Metaphone</title>

  <link rel="stylesheet" href="../rdoc.css" type="text/css" media="screen" />

  <script src="../js/jquery.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../js/thickbox-compressed.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../js/quicksearch.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="../js/darkfish.js" type="text/javascript"
    charset="utf-8"></script>

</head>
<body class="module">

  <div class="head">
    <h1 class="module">English::Metaphone</h1>
  </div>

  <div id="metadata">
    <div id="project-metadata">

      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../lib/english/metaphone_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="lib/english/metaphone.rb">lib/english/metaphone.rb</a></li>
          
          </ul>
        </div>
      </div>

      <!-- What about Git info, or Hg info? This seems almost silly, albeit kind of cool. -->

      
    </div>

    <div id="class-metadata">

      <!-- Parent Class -->
      

      <!-- Namespace Contents -->
      

      <!-- Method Quickref -->
      
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#M000067">::calculate_double_metaphone</a></li>
          
          <li><a href="#M000065">::double_metaphone</a></li>
          
          <li><a href="#M000075">::lookup</a></li>
          
          <li><a href="#M000061">::metaphone</a></li>
          
          <li><a href="#M000062">::metaphone_word</a></li>
          
          <li><a href="#M000072">::slavo_germanic?</a></li>
          
          <li><a href="#M000074">::vowel?</a></li>
          
          <li><a href="#M000100">#double_metaphone</a></li>
          
          <li><a href="#M000098">#metaphone</a></li>
          
        </ul>
      </div>
      

      <!-- Included Modules -->
      
    </div>

    <div id="project-metadata">
      
      
      <div id="fileindex-section" class="section project-section">
        <h3 class="section-header">Files</h3>
        <ul>
        
          <li class="file"><a href="../COPYING.html">COPYING</a></li>
        
          <li class="file"><a href="../HISTORY.html">HISTORY</a></li>
        
          <li class="file"><a href="../README_rdoc.html">README.rdoc</a></li>
        
        </ul>
      </div>
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class Index
          <span class="search-toggle"><img src="../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <!-- classpage.html : classes -->
        <ul class="link-list">
        
          <li class="module"><a href="../English.html">English</a></li>
        
          <li class="class"><a href="../English/Array.html">English::Array</a></li>
        
          <li class="class"><a href="../English/Censor.html">English::Censor</a></li>
        
          <li class="module"><a href="../English/Conjunction.html">English::Conjunction</a></li>
        
          <li class="module"><a href="../English/Inflect.html">English::Inflect</a></li>
        
          <li class="class"><a href="../English/Integer.html">English::Integer</a></li>
        
          <li class="module"><a href="../English/Metaphone.html">English::Metaphone</a></li>
        
          <li class="module"><a href="../English/Namecase.html">English::Namecase</a></li>
        
          <li class="module"><a href="../English/Numeral.html">English::Numeral</a></li>
        
          <li class="module"><a href="../English/Obfuscate.html">English::Obfuscate</a></li>
        
          <li class="module"><a href="../English/Soundex.html">English::Soundex</a></li>
        
          <li class="module"><a href="../English/Stemming.html">English::Stemming</a></li>
        
          <li class="module"><a href="../English/Structure.html">English::Structure</a></li>
        
          <li class="class"><a href="../Array.html">Array</a></li>
        
          <li class="class"><a href="../Integer.html">Integer</a></li>
        
          <li class="class"><a href="../String.html">String</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>

    <div id="validator-badges">
      Generated with <a href="http://github.com/proutils/rdazzle">Razzle Dazzle Redfish</a>.<br/>
      <a href="http://validator.w3.org/check/referer">[Validate]</a>
    </div>
  </div>

  <div id="documentation">

    <div id="description">
      <p>
Implementation of Lawrence Philips&#8217; <a
href="Metaphone.html">Metaphone</a> and Double <a
href="Metaphone.html">Metaphone</a> algorithms.
</p>
<p>
<a href="Metaphone.html">Metaphone</a> encodes names into a phonetic form
such that similar-sounding names have the same or similar <a
href="Metaphone.html">Metaphone</a> encodings.
</p>
<p>
The original system was described by Lawrence Philips in Computer Language
Vol. 7 No. 12, December 1990, pp 39-43.
</p>
<p>
There are multiple implementations of <a
href="Metaphone.html">Metaphone</a>, each with their own quirks, I have
based this on my interpretation of the algorithm specification. Even
LP&#8217;s original BASIC implementation appears to contain bugs
(specifically with the handling of CC and MB), when compared to his
explanation of the algorithm.
</p>
<p>
I have also compared this implementation with that found in PHP&#8217;s
standard library, which appears to mimic the behaviour of LP&#8217;s
original BASIC implementation. For compatibility, these rules can also be
used by passing :alternate=>true to the methods.
</p>
<p>
Double <a href="Metaphone.html">Metaphone</a> algoirthm originally
published in the June 2000 issue of C/C++ Users Journal. Ruby version based
on Stephen Woodbridge&#8217;s PHP version - <a
href="http://swoodbridge.com/DoubleMetaPhone/">swoodbridge.com/DoubleMetaPhone/</a>
</p>
<p>
Ruby implementation of Double <a href="Metaphone.html">Metaphone</a> based
on work by Paul Battley (pbattley@gmail.com).
</p>

    </div>

    <!-- Constants -->
    
    <div id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt><a name="METAPHONE_RULES">METAPHONE_RULES</a></dt>
        
        <dd class="description"><p>
<a href="Metaphone.html">Metaphone</a> rules. These are simply applied in
order.
</p></dd>
        
      
        <dt><a name="METAPHONE_RULES_LP">METAPHONE_RULES_LP</a></dt>
        
        <dd class="description"><p>
The rules for the &#8216;buggy&#8217; alternate implementation used by PHP
etc.
</p></dd>
        
      
      </dl>
    </div>
    

    <!-- Attributes -->
    

    <!-- Methods -->
    
    <div id="public-class-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="double-metaphone-method" class="method-detail ">
        <a name="M000065"></a>

        <div class="method-heading">
        
          <span class="method-name">double_metaphone</span><span
            class="method-args">(string)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Returns the primary and secondary double metaphone tokens (the secondary
will be nil if equal to the primary).
</p>
          

          
          <div class="method-source-code"
            id="double-metaphone-source">
<pre>
<span class="ruby-comment cmt"># File lib/english/metaphone.rb, line 99</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">double_metaphone</span>(<span class="ruby-identifier">string</span>)
      <span class="ruby-identifier">string</span> = <span class="ruby-identifier">string</span>.<span class="ruby-identifier">to_s</span>
      <span class="ruby-ivar">@db_memo</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Hash</span>.<span class="ruby-identifier">new</span>
      <span class="ruby-ivar">@db_memo</span>[<span class="ruby-identifier">string</span>] = <span class="ruby-identifier">calculate_double_metaphone</span>(<span class="ruby-identifier">string</span>)
    <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="metaphone-method" class="method-detail ">
        <a name="M000061"></a>

        <div class="method-heading">
        
          <span class="method-name">metaphone</span><span
            class="method-args">(string, alt=nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Returns the <a href="Metaphone.html">Metaphone</a> representation of a
string. If the string contains multiple words, each word in turn is
converted into its <a href="Metaphone.html">Metaphone</a> representation.
Note that only the letters A-Z are supported, so any language-specific
processing should be done beforehand.
</p>
<p>
If <tt>alt</tt> is set to true, alternate &#8216;buggy&#8217; rules are
used.
</p>
          

          
          <div class="method-source-code"
            id="metaphone-source">
<pre>
<span class="ruby-comment cmt"># File lib/english/metaphone.rb, line 80</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">metaphone</span>(<span class="ruby-identifier">string</span>, <span class="ruby-identifier">alt</span>=<span class="ruby-keyword kw">nil</span>)
      <span class="ruby-identifier">string</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/\s+/</span>).<span class="ruby-identifier">map</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">w</span><span class="ruby-operator">|</span> <span class="ruby-identifier">metaphone_word</span>(<span class="ruby-identifier">w</span>, <span class="ruby-identifier">alt</span>) }.<span class="ruby-identifier">join</span>(<span class="ruby-value str">' '</span>)
    <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
    </div>
  
    <div id="private-class-method-details" class="method-section section">
      <h3 class="section-header">Private Class Methods</h3>

    
      <div id="calculate-double-metaphone-method" class="method-detail ">
        <a name="M000067"></a>

        <div class="method-heading">
        
          <span class="method-name">calculate_double_metaphone</span><span
            class="method-args">(str)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p class="missing-docs">(Not documented)</p>
          

          
          <div class="method-source-code"
            id="calculate-double-metaphone-source">
<pre>
<span class="ruby-comment cmt"># File lib/english/metaphone.rb, line 107</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">calculate_double_metaphone</span>(<span class="ruby-identifier">str</span>)
      <span class="ruby-identifier">primary</span>, <span class="ruby-identifier">secondary</span>, <span class="ruby-identifier">current</span> = <span class="ruby-value str">''</span>, <span class="ruby-value str">''</span>, <span class="ruby-value">0</span>
      <span class="ruby-identifier">original</span>, <span class="ruby-identifier">length</span>, <span class="ruby-identifier">last</span> = <span class="ruby-node">&quot;#{str}     &quot;</span>.<span class="ruby-identifier">upcase</span>, <span class="ruby-identifier">str</span>.<span class="ruby-identifier">length</span>, <span class="ruby-identifier">str</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/^GN|KN|PN|WR|PS$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">original</span>[<span class="ruby-value">0</span>, <span class="ruby-value">2</span>]
        <span class="ruby-identifier">current</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">if</span> <span class="ruby-value str">'X'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">original</span>[<span class="ruby-value">0</span>, <span class="ruby-value">1</span>]
        <span class="ruby-identifier">primary</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'S'</span>
        <span class="ruby-identifier">secondary</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">'S'</span>
        <span class="ruby-identifier">current</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">primary</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">4</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">secondary</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">4</span>
        <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">str</span>.<span class="ruby-identifier">length</span>
        <span class="ruby-identifier">a</span>, <span class="ruby-identifier">b</span>, <span class="ruby-identifier">c</span> = <span class="ruby-identifier">lookup</span>(<span class="ruby-identifier">original</span>, <span class="ruby-identifier">current</span>, <span class="ruby-identifier">length</span>, <span class="ruby-identifier">last</span>)
        <span class="ruby-identifier">primary</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">a</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>
        <span class="ruby-identifier">secondary</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">b</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">b</span>
        <span class="ruby-identifier">current</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>
      <span class="ruby-keyword kw">end</span>
      <span class="ruby-identifier">primary</span>, <span class="ruby-identifier">secondary</span> = <span class="ruby-identifier">primary</span>[<span class="ruby-value">0</span>, <span class="ruby-value">4</span>], <span class="ruby-identifier">secondary</span>[<span class="ruby-value">0</span>, <span class="ruby-value">4</span>]
      <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">primary</span>, (<span class="ruby-identifier">primary</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">secondary</span> <span class="ruby-value">? </span><span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">secondary</span>)
    <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="lookup-method" class="method-detail ">
        <a name="M000075"></a>

        <div class="method-heading">
        
          <span class="method-name">lookup</span><span
            class="method-args">(str, pos, length, last)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p class="missing-docs">(Not documented)</p>
          

          
          <div class="method-source-code"
            id="lookup-source">
<pre>
<span class="ruby-comment cmt"># File lib/english/metaphone.rb, line 137</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lookup</span>(<span class="ruby-identifier">str</span>, <span class="ruby-identifier">pos</span>, <span class="ruby-identifier">length</span>, <span class="ruby-identifier">last</span>)
      <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">1</span>]
        <span class="ruby-keyword kw">when</span> <span class="ruby-regexp re">/^A|E|I|O|U|Y$/</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-value">0</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span>
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'A'</span>, <span class="ruby-value str">'A'</span>, <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'B'</span>
          <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'P'</span>, <span class="ruby-value str">'P'</span>, (<span class="ruby-value str">'B'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">?</span> <span class="ruby-value">2</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Ã‡'</span>
          <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'S'</span>, <span class="ruby-value str">'S'</span>, <span class="ruby-value">1</span>
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'C'</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span>
            <span class="ruby-operator">!</span><span class="ruby-identifier">vowel?</span>(<span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">2</span>, <span class="ruby-value">1</span>]) <span class="ruby-operator">&amp;&amp;</span>
            <span class="ruby-value str">'ACH'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">3</span>] <span class="ruby-operator">&amp;&amp;</span>
            <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">!=</span> <span class="ruby-value str">'I'</span> <span class="ruby-operator">&amp;&amp;</span> (
              <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">!=</span> <span class="ruby-value str">'E'</span> <span class="ruby-operator">||</span>
              <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">2</span>, <span class="ruby-value">6</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^(B|M)ACHER$/</span>
            ) <span class="ruby-keyword kw">then</span>
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'K'</span>, <span class="ruby-value">2</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-value">0</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value str">'CAESAR'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">6</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'S'</span>, <span class="ruby-value str">'S'</span>, <span class="ruby-value">2</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-value str">'CHIA'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">4</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'K'</span>, <span class="ruby-value">2</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-value str">'CH'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">2</span>]
            <span class="ruby-keyword kw">if</span> <span class="ruby-value">0</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value str">'CHAE'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">4</span>]
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'X'</span>, <span class="ruby-value">2</span>
            <span class="ruby-keyword kw">elsif</span> <span class="ruby-value">0</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&amp;&amp;</span> (
                [<span class="ruby-value str">'HARAC'</span>, <span class="ruby-value str">'HARIS'</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">5</span>]) <span class="ruby-operator">||</span>
                [<span class="ruby-value str">'HOR'</span>, <span class="ruby-value str">'HYM'</span>, <span class="ruby-value str">'HIA'</span>, <span class="ruby-value str">'HEM'</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">3</span>])
              ) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">str</span>[<span class="ruby-value">0</span>, <span class="ruby-value">5</span>] <span class="ruby-operator">!=</span> <span class="ruby-value str">'CHORE'</span> <span class="ruby-keyword kw">then</span>
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'K'</span>, <span class="ruby-value">2</span>
            <span class="ruby-keyword kw">elsif</span> [<span class="ruby-value str">'VAN '</span>,<span class="ruby-value str">'VON '</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">str</span>[<span class="ruby-value">0</span>, <span class="ruby-value">4</span>]) <span class="ruby-operator">||</span>
                  <span class="ruby-value str">'SCH'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-value">0</span>, <span class="ruby-value">3</span>] <span class="ruby-operator">||</span>
                  [<span class="ruby-value str">'ORCHES'</span>,<span class="ruby-value str">'ARCHIT'</span>,<span class="ruby-value str">'ORCHID'</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">2</span>, <span class="ruby-value">6</span>]) <span class="ruby-operator">||</span>
                  [<span class="ruby-value str">'T'</span>,<span class="ruby-value str">'S'</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>, <span class="ruby-value">1</span>]) <span class="ruby-operator">||</span> (
                    ((<span class="ruby-value">0</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span>) <span class="ruby-operator">||</span> [<span class="ruby-value str">'A'</span>,<span class="ruby-value str">'O'</span>,<span class="ruby-value str">'U'</span>,<span class="ruby-value str">'E'</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>])) <span class="ruby-operator">&amp;&amp;</span>
                    [<span class="ruby-value str">'L'</span>,<span class="ruby-value str">'R'</span>,<span class="ruby-value str">'N'</span>,<span class="ruby-value str">'M'</span>,<span class="ruby-value str">'B'</span>,<span class="ruby-value str">'H'</span>,<span class="ruby-value str">'F'</span>,<span class="ruby-value str">'V'</span>,<span class="ruby-value str">'W'</span>,<span class="ruby-value str">' '</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>, <span class="ruby-value">1</span>])
                  ) <span class="ruby-keyword kw">then</span>
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'K'</span>, <span class="ruby-value">2</span>
            <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
              <span class="ruby-keyword kw">return</span> (<span class="ruby-value str">'MC'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-value">0</span>, <span class="ruby-value">2</span>] <span class="ruby-operator">?</span> <span class="ruby-value str">'K'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">'X'</span>), <span class="ruby-value str">'K'</span>, <span class="ruby-value">2</span>
            <span class="ruby-keyword kw">else</span>
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'X'</span>, <span class="ruby-value str">'X'</span>, <span class="ruby-value">2</span>
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-value str">'CZ'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">2</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value str">'WICZ'</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">2</span>, <span class="ruby-value">4</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'S'</span>, <span class="ruby-value str">'X'</span>, <span class="ruby-value">2</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-value str">'CIA'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">3</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'X'</span>, <span class="ruby-value str">'X'</span>, <span class="ruby-value">3</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-value str">'CC'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">2</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span>(<span class="ruby-value">1</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value str">'M'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-value">0</span>, <span class="ruby-value">1</span>])
            <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/^I|E|H$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value str">'HU'</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>, <span class="ruby-value">2</span>]
              <span class="ruby-keyword kw">if</span> (<span class="ruby-value">1</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value str">'A'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>]) <span class="ruby-operator">||</span>
                <span class="ruby-regexp re">/^UCCE(E|S)$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">5</span>] <span class="ruby-keyword kw">then</span>
                <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'KS'</span>, <span class="ruby-value str">'KS'</span>, <span class="ruby-value">3</span>
              <span class="ruby-keyword kw">else</span>
                <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'X'</span>, <span class="ruby-value str">'X'</span>, <span class="ruby-value">3</span>
              <span class="ruby-keyword kw">end</span>
            <span class="ruby-keyword kw">else</span>
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'K'</span>, <span class="ruby-value">2</span>
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-regexp re">/^C(K|G|Q)$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">2</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'K'</span>, <span class="ruby-value">2</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-regexp re">/^C(I|E|Y)$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">2</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'S'</span>, (<span class="ruby-regexp re">/^CI(O|E|A)$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">3</span>] <span class="ruby-operator">?</span> <span class="ruby-value str">'X'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">'S'</span>), <span class="ruby-value">2</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/^ (C|Q|G)$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">2</span>]
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'K'</span>, <span class="ruby-value">3</span>
            <span class="ruby-keyword kw">else</span>
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'K'</span>, (<span class="ruby-regexp re">/^C|K|Q$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span>([<span class="ruby-value str">'CE'</span>,<span class="ruby-value str">'CI'</span>].<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">2</span>])) <span class="ruby-operator">?</span> <span class="ruby-value">2</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'D'</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-value str">'DG'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">2</span>]
            <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/^I|E|Y$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>, <span class="ruby-value">1</span>]
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'J'</span>, <span class="ruby-value str">'J'</span>, <span class="ruby-value">3</span>
            <span class="ruby-keyword kw">else</span>
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'TK'</span>, <span class="ruby-value str">'TK'</span>, <span class="ruby-value">2</span>
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'T'</span>, <span class="ruby-value str">'T'</span>, (<span class="ruby-regexp re">/^D(T|D)$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">2</span>] <span class="ruby-operator">?</span> <span class="ruby-value">2</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'F'</span>
          <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'F'</span>, <span class="ruby-value str">'F'</span>, (<span class="ruby-value str">'F'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">?</span> <span class="ruby-value">2</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'G'</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-value str">'H'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>]
            <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">vowel?</span>(<span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>])
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'K'</span>, <span class="ruby-value">2</span>
            <span class="ruby-keyword kw">elsif</span> <span class="ruby-value">0</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span>
              <span class="ruby-keyword kw">if</span> <span class="ruby-value str">'I'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>, <span class="ruby-value">1</span>]
                <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'J'</span>, <span class="ruby-value str">'J'</span>, <span class="ruby-value">2</span>
              <span class="ruby-keyword kw">else</span>
                <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'K'</span>, <span class="ruby-value">2</span>
              <span class="ruby-keyword kw">end</span>
            <span class="ruby-keyword kw">elsif</span> (<span class="ruby-identifier">pos</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-regexp re">/^B|H|D$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">2</span>, <span class="ruby-value">1</span>]) <span class="ruby-operator">||</span>
                  (<span class="ruby-identifier">pos</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-regexp re">/^B|H|D$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">3</span>, <span class="ruby-value">1</span>]) <span class="ruby-operator">||</span>
                  (<span class="ruby-identifier">pos</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">3</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-regexp re">/^B|H$/</span>   <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">4</span>, <span class="ruby-value">1</span>])
              <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">2</span>
            <span class="ruby-keyword kw">else</span>
              <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">pos</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">2</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value str">'U'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-regexp re">/^C|G|L|R|T$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">3</span>, <span class="ruby-value">1</span>])
                <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'F'</span>, <span class="ruby-value str">'F'</span>, <span class="ruby-value">2</span>
              <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value str">'I'</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>]
                <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'K'</span>, <span class="ruby-value">2</span>
              <span class="ruby-keyword kw">else</span>
                <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">2</span>
              <span class="ruby-keyword kw">end</span>
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-value str">'N'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>]
            <span class="ruby-keyword kw">if</span> <span class="ruby-value">1</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">vowel?</span>(<span class="ruby-identifier">str</span>[<span class="ruby-value">0</span>, <span class="ruby-value">1</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">slavo_germanic?</span>(<span class="ruby-identifier">str</span>)
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'KN'</span>, <span class="ruby-value str">'N'</span>, <span class="ruby-value">2</span>
            <span class="ruby-keyword kw">else</span>
              <span class="ruby-keyword kw">if</span> <span class="ruby-value str">'EY'</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>, <span class="ruby-value">2</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value str">'Y'</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">slavo_germanic?</span>(<span class="ruby-identifier">str</span>)
                <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'N'</span>, <span class="ruby-value str">'KN'</span>, <span class="ruby-value">2</span>
              <span class="ruby-keyword kw">else</span>
                <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'KN'</span>, <span class="ruby-value str">'KN'</span>, <span class="ruby-value">2</span>
              <span class="ruby-keyword kw">end</span>
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-value str">'LI'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">2</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">slavo_germanic?</span>(<span class="ruby-identifier">str</span>)
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'KL'</span>, <span class="ruby-value str">'L'</span>, <span class="ruby-value">2</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-value">0</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-value str">'Y'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">||</span> <span class="ruby-regexp re">/^(E(S|P|B|L|Y|I|R)|I(B|L|N|E))$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">2</span>])
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'J'</span>, <span class="ruby-value">2</span>
          <span class="ruby-keyword kw">elsif</span> ((<span class="ruby-value str">'ER'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">2</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">'Y'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>]) <span class="ruby-operator">&amp;&amp;</span>
                 <span class="ruby-regexp re">/^(D|R|M)ANGER$/</span> <span class="ruby-operator">!~</span> <span class="ruby-identifier">str</span>[<span class="ruby-value">0</span>, <span class="ruby-value">6</span>] <span class="ruby-operator">&amp;&amp;</span>
                 <span class="ruby-regexp re">/^E|I$/</span> <span class="ruby-operator">!~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">&amp;&amp;</span>
                 <span class="ruby-regexp re">/^(R|O)GY$/</span> <span class="ruby-operator">!~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">3</span>])
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'J'</span>, <span class="ruby-value">2</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-regexp re">/^E|I|Y$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">||</span> <span class="ruby-regexp re">/^(A|O)GGI$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">4</span>]
            <span class="ruby-keyword kw">if</span> (<span class="ruby-regexp re">/^V(A|O)N $/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-value">0</span>, <span class="ruby-value">4</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">'SCH'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-value">0</span>, <span class="ruby-value">3</span>]) <span class="ruby-operator">||</span> <span class="ruby-value str">'ET'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">2</span>]
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'K'</span>, <span class="ruby-value">2</span>
            <span class="ruby-keyword kw">else</span>
              <span class="ruby-keyword kw">if</span> <span class="ruby-value str">'IER '</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">4</span>]
                <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'J'</span>, <span class="ruby-value str">'J'</span>, <span class="ruby-value">2</span>
              <span class="ruby-keyword kw">else</span>
                <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'J'</span>, <span class="ruby-value str">'K'</span>, <span class="ruby-value">2</span>
              <span class="ruby-keyword kw">end</span>
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-value str">'G'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'K'</span>, <span class="ruby-value">2</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'K'</span>, <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'H'</span>
          <span class="ruby-keyword kw">if</span> (<span class="ruby-value">0</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">vowel?</span>(<span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>])) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">vowel?</span>(<span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>])
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'H'</span>, <span class="ruby-value str">'H'</span>, <span class="ruby-value">2</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'J'</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-value str">'JOSE'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">4</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">'SAN '</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-value">0</span>, <span class="ruby-value">4</span>]
            <span class="ruby-keyword kw">if</span> (<span class="ruby-value">0</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value str">' '</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">4</span>, <span class="ruby-value">1</span>]) <span class="ruby-operator">||</span> <span class="ruby-value str">'SAN '</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-value">0</span>, <span class="ruby-value">4</span>]
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'H'</span>, <span class="ruby-value str">'H'</span>, <span class="ruby-value">1</span>
            <span class="ruby-keyword kw">else</span>
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'J'</span>, <span class="ruby-value str">'H'</span>, <span class="ruby-value">1</span>
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-identifier">current</span> = (<span class="ruby-value str">'J'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">?</span> <span class="ruby-value">2</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)

            <span class="ruby-keyword kw">if</span> <span class="ruby-value">0</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value str">'JOSE'</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">4</span>]
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'J'</span>, <span class="ruby-value str">'A'</span>, <span class="ruby-identifier">current</span>
            <span class="ruby-keyword kw">else</span>
              <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">vowel?</span>(<span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">slavo_germanic?</span>(<span class="ruby-identifier">str</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-regexp re">/^A|O$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>]
                <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'J'</span>, <span class="ruby-value str">'H'</span>, <span class="ruby-identifier">current</span>
              <span class="ruby-keyword kw">else</span>
                <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">last</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span>
                  <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'J'</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">current</span>
                <span class="ruby-keyword kw">else</span>
                  <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/^L|T|K|S|N|M|B|Z$/</span> <span class="ruby-operator">!~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-regexp re">/^S|K|L$/</span> <span class="ruby-operator">!~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>]
                    <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'J'</span>, <span class="ruby-value str">'J'</span>, <span class="ruby-identifier">current</span>
                  <span class="ruby-keyword kw">else</span>
                    <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">current</span>
                  <span class="ruby-keyword kw">end</span>
                <span class="ruby-keyword kw">end</span>
              <span class="ruby-keyword kw">end</span>
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'K'</span>
          <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'K'</span>, (<span class="ruby-value str">'K'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">?</span> <span class="ruby-value">2</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'L'</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-value str">'L'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>]
            <span class="ruby-keyword kw">if</span> (((<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">3</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-regexp re">/^(ILL(O|A)|ALLE)$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">4</span>]) <span class="ruby-operator">||</span>
                ((<span class="ruby-regexp re">/^(A|O)S$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">last</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">2</span>] <span class="ruby-operator">||</span> <span class="ruby-regexp re">/^A|O$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">last</span>, <span class="ruby-value">1</span>]) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value str">'ALLE'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">4</span>]))
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'L'</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">2</span>
            <span class="ruby-keyword kw">else</span>
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'L'</span>, <span class="ruby-value str">'L'</span>, <span class="ruby-value">2</span>
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'L'</span>, <span class="ruby-value str">'L'</span>, <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'M'</span>
          <span class="ruby-keyword kw">if</span> (<span class="ruby-value str">'UMB'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">3</span>] <span class="ruby-operator">&amp;&amp;</span>
              ((<span class="ruby-identifier">last</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">||</span> <span class="ruby-value str">'ER'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>, <span class="ruby-value">2</span>])) <span class="ruby-operator">||</span> <span class="ruby-value str">'M'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'M'</span>, <span class="ruby-value str">'M'</span>, <span class="ruby-value">2</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'M'</span>, <span class="ruby-value str">'M'</span>, <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'N'</span>
          <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'N'</span>, <span class="ruby-value str">'N'</span>, (<span class="ruby-value str">'N'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">?</span> <span class="ruby-value">2</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Ã‘'</span>
          <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'N'</span>, <span class="ruby-value str">'N'</span>, <span class="ruby-value">1</span>
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'P'</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-value str">'H'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'F'</span>, <span class="ruby-value str">'F'</span>, <span class="ruby-value">2</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'P'</span>, <span class="ruby-value str">'P'</span>, (<span class="ruby-regexp re">/^P|B$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">?</span> <span class="ruby-value">2</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Q'</span>
          <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'K'</span>, <span class="ruby-value str">'K'</span>, (<span class="ruby-value str">'Q'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">?</span> <span class="ruby-value">2</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'R'</span>
          <span class="ruby-identifier">current</span> = (<span class="ruby-value str">'R'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">?</span> <span class="ruby-value">2</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)

          <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">last</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">slavo_germanic?</span>(<span class="ruby-identifier">str</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value str">'IE'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">2</span>, <span class="ruby-value">2</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-regexp re">/^M(E|A)$/</span> <span class="ruby-operator">!~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">4</span>, <span class="ruby-value">2</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-value str">'R'</span>, <span class="ruby-identifier">current</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'R'</span>, <span class="ruby-value str">'R'</span>, <span class="ruby-identifier">current</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'S'</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/^(I|Y)SL$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">3</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-value">0</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value str">'SUGAR'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">5</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'X'</span>, <span class="ruby-value str">'S'</span>, <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-value str">'SH'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">2</span>]
            <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/^H(EIM|OEK|OLM|OLZ)$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">4</span>]
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'S'</span>, <span class="ruby-value str">'S'</span>, <span class="ruby-value">2</span>
            <span class="ruby-keyword kw">else</span>
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'X'</span>, <span class="ruby-value str">'X'</span>, <span class="ruby-value">2</span>
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-regexp re">/^SI(O|A)$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">3</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">'SIAN'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">4</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'S'</span>, (<span class="ruby-identifier">slavo_germanic?</span>(<span class="ruby-identifier">str</span>) <span class="ruby-operator">?</span> <span class="ruby-value str">'S'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">'X'</span>), <span class="ruby-value">3</span>
          <span class="ruby-keyword kw">elsif</span> (<span class="ruby-value">0</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-regexp re">/^M|N|L|W$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>]) <span class="ruby-operator">||</span> <span class="ruby-value str">'Z'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'S'</span>, <span class="ruby-value str">'X'</span>, (<span class="ruby-value str">'Z'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">?</span> <span class="ruby-value">2</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-value str">'SC'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">2</span>]
            <span class="ruby-keyword kw">if</span> <span class="ruby-value str">'H'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>, <span class="ruby-value">1</span>]
              <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/^OO|ER|EN|UY|ED|EM$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">3</span>, <span class="ruby-value">2</span>]
                <span class="ruby-keyword kw">return</span> (<span class="ruby-regexp re">/^E(R|N)$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">3</span>, <span class="ruby-value">2</span>] <span class="ruby-operator">?</span> <span class="ruby-value str">'X'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">'SK'</span>), <span class="ruby-value str">'SK'</span>, <span class="ruby-value">3</span>
              <span class="ruby-keyword kw">else</span>
                <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'X'</span>, ((<span class="ruby-value">0</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">vowel?</span>(<span class="ruby-identifier">str</span>[<span class="ruby-value">3</span>, <span class="ruby-value">1</span>]) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-value str">'W'</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">3</span>, <span class="ruby-value">1</span>])) <span class="ruby-operator">?</span> <span class="ruby-value str">'S'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">'X'</span>), <span class="ruby-value">3</span>
              <span class="ruby-keyword kw">end</span>
            <span class="ruby-keyword kw">elsif</span> <span class="ruby-regexp re">/^I|E|Y$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>, <span class="ruby-value">1</span>]
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'S'</span>, <span class="ruby-value str">'S'</span>, <span class="ruby-value">3</span>
            <span class="ruby-keyword kw">else</span>
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'SK'</span>, <span class="ruby-value str">'SK'</span>, <span class="ruby-value">3</span>
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-keyword kw">return</span> (<span class="ruby-identifier">last</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-regexp re">/^(A|O)I$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">2</span>, <span class="ruby-value">2</span>] <span class="ruby-operator">?</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">:</span> <span class="ruby-value str">'S'</span>), <span class="ruby-value str">'S'</span>, (<span class="ruby-regexp re">/^S|Z$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">?</span> <span class="ruby-value">2</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'T'</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-value str">'TION'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">4</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'X'</span>, <span class="ruby-value str">'X'</span>, <span class="ruby-value">3</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-regexp re">/^T(IA|CH)$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">3</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'X'</span>, <span class="ruby-value str">'X'</span>, <span class="ruby-value">3</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-value str">'TH'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">2</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">'TTH'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">3</span>]
            <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/^(O|A)M$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">2</span>, <span class="ruby-value">2</span>] <span class="ruby-operator">||</span> <span class="ruby-regexp re">/^V(A|O)N $/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-value">0</span>, <span class="ruby-value">4</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">'SCH'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-value">0</span>, <span class="ruby-value">3</span>]
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'T'</span>, <span class="ruby-value str">'T'</span>, <span class="ruby-value">2</span>
            <span class="ruby-keyword kw">else</span>
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'0'</span>, <span class="ruby-value str">'T'</span>, <span class="ruby-value">2</span>
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'T'</span>, <span class="ruby-value str">'T'</span>, (<span class="ruby-regexp re">/^T|D$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">?</span> <span class="ruby-value">2</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'V'</span>
          <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'F'</span>, <span class="ruby-value str">'F'</span>, (<span class="ruby-value str">'V'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">?</span> <span class="ruby-value">2</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'W'</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-value str">'WR'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">2</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'R'</span>, <span class="ruby-value str">'R'</span>, <span class="ruby-value">2</span>
          <span class="ruby-keyword kw">end</span>
          <span class="ruby-identifier">pri</span>, <span class="ruby-identifier">sec</span> = <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-value">0</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">vowel?</span>(<span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>]) <span class="ruby-operator">||</span> <span class="ruby-value str">'WH'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">2</span>])
            <span class="ruby-identifier">pri</span> = <span class="ruby-value str">'A'</span>
            <span class="ruby-identifier">sec</span> = <span class="ruby-identifier">vowel?</span>(<span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>]) <span class="ruby-operator">?</span> <span class="ruby-value str">'F'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">'A'</span>
          <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">last</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">vowel?</span>(<span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>])) <span class="ruby-operator">||</span> <span class="ruby-value str">'SCH'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-value">0</span>, <span class="ruby-value">3</span>] <span class="ruby-operator">||</span>
              <span class="ruby-regexp re">/^EWSKI|EWSKY|OWSKI|OWSKY$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">5</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">pri</span>, <span class="ruby-node">&quot;#{sec}F&quot;</span>, <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">elsif</span> <span class="ruby-regexp re">/^WI(C|T)Z$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span>, <span class="ruby-value">4</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-node">&quot;#{pri}TS&quot;</span>, <span class="ruby-node">&quot;#{sec}FX&quot;</span>, <span class="ruby-value">4</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">pri</span>, <span class="ruby-identifier">sec</span>, <span class="ruby-value">1</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'X'</span>
          <span class="ruby-identifier">current</span> = (<span class="ruby-regexp re">/^C|X$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">?</span> <span class="ruby-value">2</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
          <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">last</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">pos</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-regexp re">/^(I|E)AU$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">3</span>, <span class="ruby-value">3</span>] <span class="ruby-operator">||</span> <span class="ruby-regexp re">/^(A|O)U$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">2</span>, <span class="ruby-value">2</span>]))
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'KS'</span>, <span class="ruby-value str">'KS'</span>, <span class="ruby-identifier">current</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">current</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">when</span> <span class="ruby-value str">'Z'</span>
          <span class="ruby-keyword kw">if</span> <span class="ruby-value str">'H'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>]
            <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'J'</span>, <span class="ruby-value str">'J'</span>, <span class="ruby-value">2</span>
          <span class="ruby-keyword kw">else</span>
            <span class="ruby-identifier">current</span> = (<span class="ruby-value str">'Z'</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>] <span class="ruby-operator">?</span> <span class="ruby-value">2</span> <span class="ruby-operator">:</span> <span class="ruby-value">1</span>)
            <span class="ruby-keyword kw">if</span> <span class="ruby-regexp re">/^Z(O|I|A)$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>, <span class="ruby-value">2</span>] <span class="ruby-operator">||</span> (<span class="ruby-identifier">slavo_germanic?</span>(<span class="ruby-identifier">str</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">pos</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-value str">'T'</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">str</span>[<span class="ruby-identifier">pos</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>, <span class="ruby-value">1</span>]))
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'S'</span>, <span class="ruby-value str">'TS'</span>, <span class="ruby-identifier">current</span>
            <span class="ruby-keyword kw">else</span>
              <span class="ruby-keyword kw">return</span> <span class="ruby-value str">'S'</span>, <span class="ruby-value str">'S'</span>, <span class="ruby-identifier">current</span>
            <span class="ruby-keyword kw">end</span>
          <span class="ruby-keyword kw">end</span>
        <span class="ruby-keyword kw">else</span>
          <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span>, <span class="ruby-keyword kw">nil</span>, <span class="ruby-value">1</span>
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="metaphone-word-method" class="method-detail ">
        <a name="M000062"></a>

        <div class="method-heading">
        
          <span class="method-name">metaphone_word</span><span
            class="method-args">(w, alt=nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p class="missing-docs">(Not documented)</p>
          

          
          <div class="method-source-code"
            id="metaphone-word-source">
<pre>
<span class="ruby-comment cmt"># File lib/english/metaphone.rb, line 86</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">metaphone_word</span>(<span class="ruby-identifier">w</span>, <span class="ruby-identifier">alt</span>=<span class="ruby-keyword kw">nil</span>)
      <span class="ruby-comment cmt"># Normalise case and remove non-ASCII</span>
      <span class="ruby-identifier">s</span> = <span class="ruby-identifier">w</span>.<span class="ruby-identifier">downcase</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp re">/[^a-z]/</span>, <span class="ruby-value str">''</span>)
      <span class="ruby-comment cmt"># Apply the Metaphone rules</span>
      <span class="ruby-identifier">rules</span> = <span class="ruby-identifier">alt</span> <span class="ruby-value">? </span><span class="ruby-constant">METAPHONE_RULES_LP</span> <span class="ruby-operator">:</span> <span class="ruby-constant">METAPHONE_RULES</span>
      <span class="ruby-identifier">rules</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">rx</span>, <span class="ruby-identifier">rep</span><span class="ruby-operator">|</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-identifier">rx</span>, <span class="ruby-identifier">rep</span>) }
      <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">upcase</span>
    <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="slavo-germanic--method" class="method-detail ">
        <a name="M000072"></a>

        <div class="method-heading">
        
          <span class="method-name">slavo_germanic?</span><span
            class="method-args">(str)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p class="missing-docs">(Not documented)</p>
          

          
          <div class="method-source-code"
            id="slavo-germanic--source">
<pre>
<span class="ruby-comment cmt"># File lib/english/metaphone.rb, line 129</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">slavo_germanic?</span>(<span class="ruby-identifier">str</span>)
      <span class="ruby-regexp re">/W|K|CZ|WITZ/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>
    <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="vowel--method" class="method-detail ">
        <a name="M000074"></a>

        <div class="method-heading">
        
          <span class="method-name">vowel?</span><span
            class="method-args">(str)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p class="missing-docs">(Not documented)</p>
          

          
          <div class="method-source-code"
            id="vowel--source">
<pre>
<span class="ruby-comment cmt"># File lib/english/metaphone.rb, line 133</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">vowel?</span>(<span class="ruby-identifier">str</span>)
      <span class="ruby-regexp re">/^A|E|I|O|U|Y$/</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">str</span>
    <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
    </div>
  
    <div id="private-instance-method-details" class="method-section section">
      <h3 class="section-header">Private Instance Methods</h3>

    
      <div id="double-metaphone-method" class="method-detail ">
        <a name="M000100"></a>

        <div class="method-heading">
        
          <span class="method-name">double_metaphone</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Mixable form of double_metaphone.
</p>
          

          
          <div class="method-source-code"
            id="double-metaphone-source">
<pre>
<span class="ruby-comment cmt"># File lib/english/metaphone.rb, line 444</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">double_metaphone</span>
      <span class="ruby-constant">Metaphone</span>.<span class="ruby-identifier">double_metaphone</span>(<span class="ruby-identifier">to_s</span>)
    <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
      <div id="metaphone-method" class="method-detail ">
        <a name="M000098"></a>

        <div class="method-heading">
        
          <span class="method-name">metaphone</span><span
            class="method-args">(alt=nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        
        </div>

        <div class="method-description">
          
          <p>
Mixable form of metaphone.
</p>
          

          
          <div class="method-source-code"
            id="metaphone-source">
<pre>
<span class="ruby-comment cmt"># File lib/english/metaphone.rb, line 439</span>
    <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">metaphone</span>(<span class="ruby-identifier">alt</span>=<span class="ruby-keyword kw">nil</span>)
      <span class="ruby-constant">Metaphone</span>.<span class="ruby-identifier">metaphone</span>(<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">alt</span>=<span class="ruby-keyword kw">nil</span>)
    <span class="ruby-keyword kw">end</span></pre>
          </div>
          
        </div>

        
      </div>

    
    </div>
  

  </div>


  <div id="rdoc-debugging-section-dump" class="debugging-section">
  
    <p>Disabled; run with --debug to generate this.</p>
  
  </div>

</body>
</html>
